@using Bicks.Models
@model Bicks.Areas.Sales.ViewModels.SaleViewModel

@{
    ViewData["Title"] = "Create Sales";
    ViewData["Heading"] = "Create Sales";
}
<style>

    #progressBar {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 100;
        width: 100%;
        height: 100%;
        background-color: rgba(196, 196, 196, 0.8);
        padding: 20px;
    }

    #progressBar-inner {
        display: block;
        position: absolute;
        margin: 0;
        top: 40%;
        left: 50%;
        -ms-transform: translate(-50%, -40%);
        transform: translate(-50%, -50%);
        max-width: 700px;
        width: 100%;
        background-color: #FFF;
        border: solid #000 2px;
        border-radius: 0.5rem;
        padding: 1rem;
    }

    .progress-bar-fill.indeterminate {
        position: relative;
        animation: progress-indeterminate 1.5s linear infinite;
    }

    @@keyframes progress-indeterminate {
        from {
            left: 0%;
            width: 20%;
        }

        to {
            left: 80%;
            width: 20%;
        }
    }

    .progress-bar {
        width: calc(100% - 6px);
        background: #e0e0e0;
        padding: 3px;
        border-radius: 3px;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, .2);
    }

    .progress-bar-fill {
        display: block;
        height: 5px;
        background: #c7382e;
        border-radius: 3px;
        transition: width 250ms ease-in-out;
    }

    .progress-bar h3 {
        color: #000000;
        text-align: center;
    }

    .accordion {
        border: none;
        text-align: left;
        width: 100%;
        cursor: pointer;
        font-size: 15px;
        transition: 0.4s;
    }

        .active, .accordion:hover {
            background-color: #ccc;
        }

    .panel {
        padding: 0 18px;
        display: none;
        background-color: white;
        overflow: hidden;
    }
</style>

@section Toolbar {
    <li class="nav-item toolbar-item">
        <a href="javascript:submitForm()">
            <i class="fa fa-check"></i>
            <p class="">Finish Sale</p>
        </a>
    </li>
    <li class="nav-item toolbar-item">
        <a asp-area="Sales" asp-controller="Sales" asp-action="SalesList">
            <i class="fa fa-times"></i>
            <p class="">Cancel</p>
        </a>
    </li>
}

@section Scripts {
    <script type="text/javascript">
        function submitForm() {
            $('#create-sale-form').submit();
        }
    </script>
    <script>
        var acc = document.getElementsByClassName("accordion");
        var i;

        for (i = 0; i < acc.length; i++) {
            acc[i].addEventListener("click", function () {
                event.preventDefault();
                this.classList.toggle("active");
                var panel = this.nextElementSibling;
                if (panel.style.display === "block") {
                    panel.style.display = "none";
                } else {
                    panel.style.display = "block";
                }
            });
        }
    </script>
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

<form method="post" id="create-sale-form">
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
    <input asp-for="Client.ID" hidden />
    @{
        List<Category> categories = new List<Category>();
        List<SubCategory> subCategories = new List<SubCategory>();
        foreach (InvoiceItem invoiceItem in Model.InvoiceItems)
        {
            if (!categories.Any(item => item.ID == invoiceItem.Product.SubCategory.Category.ID))
            {
                categories.Add(invoiceItem.Product.SubCategory.Category);
            }
            if (!subCategories.Any(item => item.ID == invoiceItem.Product.SubCategory.ID))
            {
                subCategories.Add(invoiceItem.Product.SubCategory);
            }
        }
    }
    @{
        if (Model.RecommendedItems.Count > 0)
        {
            <div class="row">
                <div class="col-12 col-xl-12">
                    <div>
                        <section class="data-section">
                            <button style="border: none;" class="accordion section-header">Recommended</button>
                            <div class="panel section-body">
                                <div class="row">
                                    @for (int i = 0; i < Model.RecommendedItems.Count; i++)
                                    {
                                        <div class="col-md-2 mb-2">
                                            <div class="card">
                                                @Html.EditorFor(m => m.RecommendedItems[i])
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>

        }
        foreach (Category category in categories)
        {
            <div class="row">
                <div class="col-12 col-xl-12">
                    <div>
                        <section class="data-section">
                            <button style="border: none;" class="accordion section-header">@category.Name</button>
                            <div class="panel section-body">
                                @foreach (SubCategory subCategory in subCategories)
                                {
                                    if (subCategory.Category == category)
                                    {
                                        <div class="row">
                                            <div class="col-12 col-xl-12">
                                                <div>
                                                    <section class="data-section">
                                                        <button class="accordion section-header">@subCategory.Name</button>
                                                        <div class="panel section-body">
                                                            <div class="row">
                                                                @for (int i = 0; i < Model.InvoiceItems.Count; i++)
                                                                {
                                                                    if (Model.InvoiceItems[i].Product.SubCategory.ID == subCategory.ID)
                                                                    {
                                                                        <div class="col-md-2 mb-2">
                                                                            <div class="card">
                                                                                @Html.EditorFor(m => m.InvoiceItems[i])
                                                                            </div>
                                                                        </div>
                                                                    }
                                                                }
                                                            </div>
                                                        </div>
                                                    </section>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                }
                            </div>
                        </section>
                    </div>
                </div>
            </div>

        }
    }
</form>

<div id="progressBar" style="display: none;">
    <div id="progressBar-inner" class="progress-bar">
        <div>
            <h3>Creating Packing List</h3>
            <span class="progress-bar-fill indeterminate"></span>
        </div>
    </div>
</div>

<script type="text/javascript">
    function showProgressBar() {
        $('#progressBar').show();
    }
</script>